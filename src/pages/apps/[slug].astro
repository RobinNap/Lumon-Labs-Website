---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const apps = await getCollection('apps');
  return apps.map((app) => ({
    params: { slug: app.slug },
    props: { app },
  }));
}

interface Props {
  app: CollectionEntry<'apps'>;
}

const { app } = Astro.props;
const { Content } = await app.render();

const platformLabels: Record<string, string> = {
  iOS: 'iPhone',
  iPadOS: 'iPad',
  macOS: 'Mac',
  watchOS: 'Watch',
  visionOS: 'Vision',
  tvOS: 'TV',
};
---

<BaseLayout 
  title={app.data.title}
  description={app.data.description}
>
  <article class="section pt-32">
    <div class="max-w-4xl mx-auto px-6">
      <!-- Back Link -->
      <a 
        href="/apps" 
        class="inline-flex items-center gap-2 font-sans text-sm text-white/50 hover:text-white transition-colors mb-8"
      >
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back to Apps
      </a>

      <!-- Header -->
      <header class="flex flex-col md:flex-row items-start gap-6 mb-10">
        <!-- App Icon -->
        {app.data.icon ? (
          <img 
            src={app.data.icon} 
            alt={`${app.data.title} icon`} 
            class="w-24 h-24 md:w-32 md:h-32 rounded-3xl shadow-2xl shrink-0" 
          />
        ) : (
          <div 
            class="w-24 h-24 md:w-32 md:h-32 rounded-3xl flex items-center justify-center text-5xl shadow-2xl shrink-0"
            style={`background: linear-gradient(135deg, ${app.data.color || '#34d399'}, ${app.data.color || '#34d399'}cc);`}
          >
            <span>âœ¦</span>
          </div>
        )}
        
        <div class="flex-1">
          <div class="flex items-center gap-3 mb-2 flex-wrap">
            <h1 class="font-serif text-4xl md:text-5xl font-light text-white">{app.data.title}</h1>
            {app.data.status === 'coming-soon' && (
              <span class="font-sans text-sm px-3 py-1 bg-amber-500/20 text-amber-300 rounded-full">Coming Soon</span>
            )}
            {app.data.status === 'beta' && (
              <span class="font-sans text-sm px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full">Beta</span>
            )}
          </div>
          <p class="font-sans text-white/70 text-lg mb-4">{app.data.tagline}</p>
          
          <!-- Platforms -->
          <div class="flex flex-wrap gap-2 mb-6">
            {app.data.platforms.map((platform) => (
              <span class="font-sans text-xs text-white/50 px-3 py-1 bg-white/5 rounded-full border border-white/10">
                {platformLabels[platform] || platform}
              </span>
            ))}
          </div>
          
          <!-- Actions -->
          <div class="flex flex-wrap gap-3">
            {app.data.appStoreUrl && app.data.status === 'available' && (
              <a 
                href={app.data.appStoreUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-primary"
              >
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                </svg>
                Download on App Store
              </a>
            )}
            {app.data.websiteUrl && (
              <a 
                href={app.data.websiteUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-secondary"
              >
                Visit Website
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                  <polyline points="15 3 21 3 21 9"/>
                  <line x1="10" y1="14" x2="21" y2="3"/>
                </svg>
              </a>
            )}
          </div>
        </div>
      </header>

      <!-- Content -->
      <div class="prose">
        <div class="glass-card p-8">
          <Content />
        </div>
      </div>
    </div>
  </article>
</BaseLayout>

<style is:global>
  .prose {
    @apply font-sans text-white/70;
  }
  .prose h2 {
    @apply font-serif text-2xl font-light text-white mt-8 mb-4 first:mt-0;
  }
  .prose h3 {
    @apply font-sans font-medium text-lg text-white mt-6 mb-3;
  }
  .prose p {
    @apply leading-relaxed mb-4;
  }
  .prose ul {
    @apply list-disc list-inside space-y-2 mb-4;
  }
  .prose li {
    @apply text-white/60;
  }
  .prose a {
    @apply text-white underline underline-offset-4 hover:text-white/80 transition-colors;
  }
  .prose strong {
    @apply text-white font-medium;
  }
</style>
